<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Tickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">

  <!-- jQuery scrip -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body class="bg-light">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">IST Conferences</a>
    <div class="navbar-nav">
      <a class="nav-link" href="index.html">Home</a>
      <a class="nav-link" href="tickets.html">Tickets</a>
      <a class="nav-link active" href="manage.html">Manage</a>
    </div>
  </div>
</nav>

<div class="container my-4">
  <h2>Product Management</h2>
  <p class="text-muted">Add, update, and search ticket products. Stored as JSON in localStorage.</p>

  <!-- REQUIRED FIELDS FORM -->
  <form id="productForm" class="row g-2">
    <div class="col-md-2">
      <input id="pId" class="form-control" placeholder="Product ID" required>
    </div>
    <div class="col-md-3">
      <input id="pTitle" class="form-control" placeholder="Description/Title" required>
    </div>
    <div class="col-md-2">
      <input id="pCategory" class="form-control" placeholder="Category/Type" required>
    </div>
    <div class="col-md-2">
      <input id="pUnit" class="form-control" placeholder="Unit" required>
    </div>
    <div class="col-md-2">
      <input id="pPrice" class="form-control" placeholder="Price" required>
    </div>
    <div class="col-md-1 d-grid">
      <button class="btn btn-primary" type="submit">Save</button>
    </div>
    <div class="col-12">
      <input id="pInfo" class="form-control" placeholder="Optional info">
    </div>
  </form>

  <div class="row mt-3 g-2">
    <div class="col-md-6">
      <input id="searchBox" class="form-control" placeholder="Search by ID/title/category...">
    </div>
    <div class="col-md-2 d-grid">
      <button id="clearBtn" class="btn btn-outline-secondary" type="button">Clear</button>
    </div>
  </div>

  <!-- DYNAMIC DISPLAY -->
  <div id="productsArea" class="row mt-4 g-3"></div>

</div>

<script>
$(function () {
  // JSON store  - local storage push
let products = JSON.parse(localStorage.getItem("products")) || [
  { id: "NYC-1DAY", title: "NYC 1-Day Pass", category: "NYC", unit: "Pass", price: "40", info: "Pick any single day" },
  { id: "NYC-WEND", title: "NYC Weekend Pass", category: "NYC", unit: "Pass", price: "80", info: "Attend full event" },
  { id: "NYC-VIP",  title: "NYC VIP Pass", category: "NYC", unit: "Pass", price: "120", info: "All-access + food & drinks" },

  { id: "MIA-1DAY", title: "Miami 1-Day Pass", category: "Miami", unit: "Pass", price: "40", info: "Pick any single day" },
  { id: "MIA-WEND", title: "Miami Weekend Pass", category: "Miami", unit: "Pass", price: "80", info: "Attend full event" },
  { id: "MIA-VIP",  title: "Miami VIP Pass", category: "Miami", unit: "Pass", price: "120", info: "All-access + food & drinks" },

  { id: "LA-1DAY", title: "LA 1-Day Pass", category: "LA", unit: "Pass", price: "40", info: "Pick any single day" },
  { id: "LA-WEND", title: "LA Weekend Pass", category: "LA", unit: "Pass", price: "80", info: "Attend full event" },
  { id: "LA-VIP",  title: "LA VIP Pass", category: "LA", unit: "Pass", price: "120", info: "All-access + food & drinks" }
];

  function save() {
    localStorage.setItem("products", JSON.stringify(products));
    $("#jsonOut").text(JSON.stringify(products, null, 2));
  }

  function render(list) {
    $("#productsArea").empty();
    list.forEach(p => {
      $("#productsArea").append(`
        <div class="col-md-4">
          <div class="card p-3 h-100">
            <h5>${p.title}</h5>
            <div><strong>ID:</strong> ${p.id}</div>
            <div><strong>Category:</strong> ${p.category}</div>
            <div><strong>Unit:</strong> ${p.unit}</div>
            <div><strong>Price:</strong> $${p.price}</div>
            <div class="text-muted">${p.info || ""}</div>
            <button class="btn btn-sm btn-outline-primary mt-2 editBtn" data-id="${p.id}">Edit</button>
          </div>
        </div>
      `);
    });
  }

  // initial
  save();
  render(products);

  // create and update items
  $("#productForm").on("submit", function (e) {
    e.preventDefault();

    const p = {
      id: $("#pId").val().trim(),
      title: $("#pTitle").val().trim(),
      category: $("#pCategory").val().trim(),
      unit: $("#pUnit").val().trim(),
      price: $("#pPrice").val().trim(),
      info: $("#pInfo").val().trim()
    };

    if (isNaN(p.price)) {
      alert("Price must be a number.");
      return;
    }

    const idx = products.findIndex(x => x.id === p.id);
    if (idx >= 0) products[idx] = p;
    else products.push(p);

    save();
    render(products);
    this.reset();
  });

  // jQuery search
  $("#searchBox").on("keyup", function () {
    const q = $(this).val().toLowerCase();
    const filtered = products.filter(p =>
      p.id.toLowerCase().includes(q) ||
      p.title.toLowerCase().includes(q) ||
      p.category.toLowerCase().includes(q)
    );
    render(filtered);
  });

  $("#clearBtn").on("click", function () {
    $("#searchBox").val("");
    render(products);
  });

  // jQuery update form
  $("#productsArea").on("click", ".editBtn", function () {
    const id = $(this).data("id");
    const p = products.find(x => x.id === id);
    if (!p) return;

    $("#pId").val(p.id);
    $("#pTitle").val(p.title);
    $("#pCategory").val(p.category);
    $("#pUnit").val(p.unit);
    $("#pPrice").val(p.price);
    $("#pInfo").val(p.info);
  });
});
</script>

</body>
</html>
